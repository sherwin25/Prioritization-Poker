name: Supabase Keep-Alive

on:
  schedule:
    # Runs at 00:00 every 2 days
    - cron: '0 0 */2 * *'
  workflow_dispatch: # Allows manual triggering

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Ping Keep-Alive Endpoint
        run: |
          # Use secret if available, otherwise fallback to known URL if you didn't set secret
          TARGET_URL="${{ secrets.VERCEL_PROJECT_URL }}"
          if [ -z "$TARGET_URL" ]; then
             TARGET_URL="https://prioritization-poker.vercel.app"
          fi
          
          echo "Pinging $TARGET_URL/api/keep-alive..."
          
          # Using curl to hit the endpoint. -f fails on HTTP errors (4xx, 5xx)
          curl -f -s "$TARGET_URL/api/keep-alive"
          
          echo "Ping successful"
